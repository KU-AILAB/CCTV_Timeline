<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>KKU AI TIMELINE</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <header>
    <nav>
      <ul class="nav-list">
        {% if current_user.is_authenticated %}
          <li>안녕하세요, {{ current_user.username }}님</li>
          <li><a href="{{ url_for('my_uploads') }}">내 업로드</a></li>
          <li><a href="{{ url_for('logout') }}">로그아웃</a></li>
        {% else %}
          <li><a href="{{ url_for('login') }}">로그인</a></li>
          <li><a href="{{ url_for('signup') }}">회원가입</a></li>
        {% endif %}
      </ul>
    </nav>
  </header>

  <div class="container">
    <div class="row-content">

      <div class="left-panel">
        <h1>KKU AI TIMELINE</h1>

        <!-- 업로드·검출 폼 -->
        <form id="uploadForm" enctype="multipart/form-data">
          <label for="startTime">영상 시작 시간 (HH:MM:SS):</label>
          <input type="text" id="startTime" name="start_time" placeholder="00:00:00">

          <label for="videoFile">비디오 선택</label>
          <input type="file" id="videoFile" name="file"
                 accept=".mp4,.avi,.mov,.mkv,.wmv,.flv,.webm,.mpeg,.mpg,.ts,.m2ts,.m4v,.sec"
                 required>

          <button type="submit">검출 시각 추출</button>
          <button type="button" id="uploadOnlyBtn">영상 업로드</button>
        </form>

        <!-- 서버 영상 목록 -->
        <div class="server-videos-container">
          <h2>서버 영상 목록</h2>
          <div id="serverVideos" class="scroll-list"></div>
        </div>

        <!-- 업로드 진행률 바 -->
        <div class="upload-progress-container">
          <label>업로드 진행률:</label>
          <div class="upload-progress-bar">
            <div class="upload-progress" id="uploadProgress"></div>
          </div>
        </div>

            <!-- 비디오 플레이어 -->
        <div class="player-container">
          <video id="videoPlayer" controls>
            <source id="videoSource" type="video/mp4">
          </video>
        </div>
        
        <div class="timeline-container">
          <div id="timelines"></div>
          <div id="timelineProgress" class="timeline-progress"></div>
        </div>

        <div class="detection-results">
          <h2>탐지 결과</h2>
          <div id="detectionResults"></div>
        </div>
      </div>


      <!--
      <div class="right-panel">
        <h2>검출 결과</h2>
        <div id="detectionTable"></div>
      </div>
    -->
    </div>
  </div>

  <!-- 서비스 워커 등록 -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('{{ url_for("static", filename="js/sw.js") }}')
        .then(reg => console.log('SW 등록:', reg.scope))
        .catch(err => console.error('SW 등록 실패:', err));
    }
  </script>
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
